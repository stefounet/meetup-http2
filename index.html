<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Webperf2.0</title>

		<meta name="description" content="A Fasterize presentation">
		<meta name="author" content="Fasterize">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/fasterize.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Webperf 2.0</h1>
					<h3>Aller plus loin que les règles classiques</h3>
          <br>
          <br>
          <br>
          <br>
					<p>
						<h2>Tech2Day 2015</h2>
					</p>
					<p>
						<small>@stefounet</small>
					</p>
				</section>

        <section>
          Ce dont je ne parlerai pas : 
          <ul style="text-align:left">
            <li>in-page perf (rendering, layout, JS, requestAnimationFrame, web workers, memory), 
            <li>backend, 
            <li>TLS (session reuse, cache, tls record, certificate size), 
            <li>TCP (slow start, tcp window scaling, disable slow start after idle), 
            <li>WebRTC
            <li>resources timing, navigation timing
          </ul>
        </section>

        <section>

           <section>
            <h2>Petite</h2><h1>introduction</h1>
            <h3>(pour ceux qui vivraient encore dans des datacenters)</h3>

            <aside class="notes">
              Rapidement, c'est quoi la webperf ?
              Moi j'ai une définition simple
            </aside>

          </section>

          <section>
            Faire que les sites Web se chargent plus rapidement, 
            <span class="fragment">sur tous les navigateurs,</span> 
            <span class="fragment">tous les devices,</span> 
            <span class="fragment">toutes les connexions</span>
          </section>

          <section>
            <h2>backend/frontend</h2>
            <img src="assets/waterfall.png" width="600"> 
 
            <aside class="notes">
              On peut agir à deux niveaux : backend et frontend
              Je parlerai essentiellement de frontend
              Vous savez tous ce qu'est un waterfall ?
            </aside>

          </section>

          <section>
            mais pourquoi on fait ça ? 

            <aside class="notes">
              en ce qui me concerne c'est parce que j'ai codé en 1982 sur un ZX Spectrum avec 16Ko de RAM et aussi parce que j'ai un business là dessus ;-)
              mais sinon ...
            </aside>

          </section>

          <section>
            <img src="assets/parce que.jpg">

            <aside class="notes">
            ah, et sinon pour de vrai, ben c'est pour les utilisateurs, parce qu'on n'aime pas attendre 
            </aside>

          </section>

          <section data-transition="fast" data-background="assets/wait.jpg">

            <aside class="notes">
              <p>et donc ça a un impact sur le business
              <p>Y'a beaucoup d'études dont le fameux 100ms d'amazon qui montrent qu'il y a un impact négatif sur le business quand on ralentit un site web
              <p>De notre côté, nous on a montré l'inverse : qu'il y avait un impact positif quand on accélérait un site ! 
              <p>Par exemple, on voit la corrélation chez un client dans le secteur de la mode.
            </aside>

          </section>

          <section data-transition="fast">
            <img src="assets/conversion rate vs loadtime.jpg">
 
            <aside class="notes">
              distribution des temps de chargement vs le taux de conversion et on voit donc clairement qu'un internaute qui charge le site rapidement transforme mieux.
              A noter que cette distribution n'est pas une gaussienne et donc mesurer des moyennes de temps de chargement n'est pas très pertinent dans notre métier
            </aside>

          </section>

          <section data-transition="fast">
            <img src="assets/pageviews vs loadtime.jpg">

            <aside class="notes">
              et pour ceux qui se posent la question, ce n'est pas près de s'arrêter 
              <p>ça montre l'évolution du poids et de la complexité des pages depuis environ 4 ans
              <p> on est passé de 700ko a 2Mo
            </aside>

           </section>

          <section data-transition="fast">
             <img src="assets/evolution size.png">

            <aside class="notes">
              mais heureusement y'a des règles qui existent pour améliorer les perfs
            </aside>

          </section>

        </section>

        <section>

          <section>
            <h1>Les limites des règles actuelles</h1>
            <h3>quand la webperf va à l'encontre de la webperf</h3>

            <aside class="notes">
              Les règles de la Webperf ont été édicté en 2007 par Steve Moise Souders dans un bouquin appelé "High Performance Websites"
            </aside>

          </section>

          <section>
            <img class="" src="assets/Moise.jpg" width="500" align="left" style="margin-bottom:400px;margin-right:50px">
            <ul style="text-align:left;font-size:0.7em">
              <li>Make Fewer HTTP Requests
              <li>Use a Content Delivery Network
              <li>Add an Expires Header
              <li>Gzip Components
              <li>Put Stylesheets at the Top
              <li>Put Scripts at the Bottom
              <li>Avoid CSS Expressions
              <li>Make JavaScript and CSS External
              <li>Reduce DNS Lookups
              <li>Minify JavaScript
              <li>Avoid Redirects
              <li>Remove Duplicate Scripts
              <li>Configure ETags
              <li>Make AJAX Cacheable
            </ul>

            <aside class="notes">
              Elles ont été complétées et affinées au fur et à mesure
              dans un second bouquin, collectif celui-là, "Even Faster websites"
            </aside>

          </section>

          <section>
            <img class="" src="assets/nouveau testament.jpg" width="400" align="left" style="margin-bottom:400px;margin-right:50px">
            <ul class="bullets" style="font-size:0.7em">
              <li>Ajax
              <li>Responsive Web
              <li>Split initial payload
              <li>Defer JS (non blocking, async)
              <li>Inline scripts position
              <li>Minify HTML
              <li>Optimize images
              <li>Sharding
              <li>Flush the document early
              <li>Use iFrame sparingly
              <li>Simplify CSS selectors
            </ul>

            <aside class="notes">
              Mais pourquoi ces règles existent, d'où elles sortent ?
            </aside>

 
         </section>

          <section>
            d'où elles viennent : 

            <ul>
              <li class="fragment">latence</li>
              <li class="fragment">TCP (handshake, slow start)</li>
              <li class="fragment">limites des navigateurs</li>
              <li class="fragment">HTTP1.1</li>
              <li class="fragment">im-mobile</li>
            </ul>

            <aside class="notes">
            <li>la latence, schématiquement c'est la longueur du tuyau, le fait qu'on doive forcément parcourir une distance pour transporter une informtation
            <li>le protocole TCP, c'est la couche de transport de nos réseaux, celle qui s'assure qu'on reçoit bien ce qui a été envoyé
            <li>les navigateurs, ben si vous avez connu un monde avec IE5.5, vous savez qu'il y en a des limites
            <li>le protocole HTTP1.1 a des limitations sur la façon de se connecter, on peut dire qu'il est pas très connecté et en plus il est sujet a mille interprétations
            <li>enfin tout ça a été rédigé en 2006, lancement du premier iphone : 2007
            </aside>

          </section>

          <section>
            <p>mais en fait, aujourd'hui</p>
            <ul>
              <li class="fragment">les navigateurs ont évolué en 10 ans (Firefox 38!)</li>
              <li class="fragment">les terminaux ont changé </li>
              <li class="fragment">les protocoles sont en train de changer (SPDY/HTTP2)</li>
              <li class="fragment">même les couches réseaux sont remises en cause (QUIC)</li>
            </ul>
            <span class="fragment">et en plus</span>
            <ul class="fragment">
              <li>la manière de coder des sites a changé : SPA, RWD</li>
              <li>les widgets ont explosé à cause des tags managers</li>
            </ul>

            <aside class="notes">
              le mobile représente 50% du surf : on rigolait encore y'a 3 ans quand tous les ans le gartner prévoyait que 50% du surf serait sur mobile mais on y est
            </aside>

          </section>

          <section data-background="assets/widgets.jpg">

             <aside class="notes">
              ce qui n'a pas disparu : latence
              <p>et donc ça conduit à une situation où les règles classiques de la webperf, celles que tout le monde connait, sont devenues dans certains cas contre productives !
            </aside>

          </section>

          <section>
            <h2>Concatenation</h2>
            <h3>
              <span class="fragment">JS / CSS</span><span class="fragment">, Images</span>
            </h3>
            <ol>
              <li class="fragment">un seul gros fichier peut ralentir la page</li>
              <li class="fragment">on tape les limites d'IE</li>
              <li class="fragment">impossible d'établir une priorité dans le code téléchargé</li>
              <li class="fragment">ça pète le cache (et le flush est plus contraignant)</li>
              <li class="fragment">maintenabilité</li>
            </ol>
            <p class="fragment">Trouver un intermédiaire en fonction de la taille et de la composition du site.</p>

            <aside class="notes">
              ça concerne les JS et les CSS mais aussi les images avec la technique du spriting
              La concaténation vient de deux choses : nb de requêtes possibles en parallèle, latence, connexion TCP 
              1. surtout le cas pour les ressrouces bloquantes. J'ai déjà croisé des CSS de 1Mo
              Le plus énervant c'est quand GTMetrix ou WPT vous dit que vous n'avez pas combiné vos CSS/JS : mais c'est ça que je veux faire !
            </aside>

          </section>

          <section>
            <h2>Sharding / Cookieless domain</h2>
            <ol>
              <li>introduit de nouvelles résolutions DNS, en général dans le head</li>
              <li>"low" vs high latency network</li>
            </ol>

            <aside class="notes">
              Définition du sharding/cookieless domain
              ça vient de deux choses : nb de requêtes possibles en parallèle, upload limité, pas de compression des headers 
              mais aujourd'hui les navigateurs sont passés de 2 à 6 requêtes en // par domaine
              low : mobile ou Chine
              deja vu : 4 ou 5 domaines statiques différents
              heureusement certains navigateurs détectent que c'est le même serveur derrière et ne refont pas de connexion TCP
            </aside>

          </section>

          <section>
            <h2>Lazyloading</h2>
            <ul>
              <li>Lazyloader les premières images est une mauvaise idée !</li>
              <li>A réserver aux images en dessous de la ligne de flottaison</li>
            </ul>

            <aside class="notes">
              l'explication est simple : le préparser/preloader/speculative parser va chercher les élements en avance de phase avant de construire le DOM
              en faisant du lazyloading, on masque les images à ce preloader et on délègue le chargement à un script qui va s'exécuter assez tard
            </aside>

          </section>

          <section>
            <h2>JS at the bottom</h2>

            <aside class="notes">
              l'explication est la même : le préparser/preloader/speculative parser va chercher les élements en avance de phase avant de construire le DOM
              c'est assez amusant de voir le JS tout en bas de page sortir en seconde requête :-)
            </aside>

           </section>

          <section>
            <h2>Minification</h2>
            <ul>
              <li class="fragment">aucun gain</li>
              <li class="fragment">sauf si on minifie de façon agressive</li>
              <li class="fragment">personne le fait parce que c'est trop dangereux</li>
            </ul>

            <aside class="notes">
              c'est du markete de la perf, ça enquiquinne tout le monde et personne n'a fait d'étude pour savoir si ça avait un vrai impact sur le parsing (source map)
            </aside>

          </section>

        </section>

        <section>

          <section>
            <h1>et si on allait plus loin ?</h1>
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

        </section>

        <section>

          <section>
            <h2>cache cache</h2>
            et pour commencer si on faisait plus de cache

            <aside class="notes">
              d'accord vous allez dire, on s'est fait avoir, webperf 2.0 mon oeil il va me dire de mettre mes pages en cache
            </aside>

          </section>

          <section>
            <h2>Cookieless cache</h2>

            <ul>
              <li>Cacher les pages dynamiques pour les nouveaux utilisateurs ou  les utilisateurs anonymes</li>
            </ul>
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

          <section>
            <h2>ESI/Ajax</h2>
            <ul>
              <li>Cacher les pages HTML et ajouter les parties dynamiques en Ajax ou en ESI</li>
            </ul>
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

        </section>

        <section>

          <section>
            <h1>Chargement progressif</h1>
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

          <section>
            <h2>Techniques de sioux</h2>

            <ul>
              <li>Async font loading</li>
              <li>Inline critical CSS/JS + async loading</li>
              <li>Inline first view</li>
              <li>JS async/defer/iframe</li>
            </ul>
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

        </section>
        
        <section>

          <section>
           <h1>Pré-</h1>
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

          <section>
            <h2>3 type</h2>
            <h3>preconnect, prefetch, prerender</h3>
           <ul>
             <li>pas très bien supporté</li>
             <li>accessible en &lt;link&gt; ou en header Link:</li>
             <li>des fois accessible via JS</li>
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

        </section>

        <section>

          <section>
            <h2>HTTP2 est arrrrivé</h2>
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

          <section>
          <p class="quote">"we’re not replacing all of HTTP — the methods, status codes, and most of the headers you use today will be the same. Instead, we’re re-defining how it gets used “on the wire” so it’s more efficient, and so that it is more gentle to the Internet itself ...." — @mnot</p>
            <br>
            <img src="assets/http2_2.png">
            <img src="assets/http2_1.png">
            <ul>
              <li>New binary framing</li>
              <li>One connection (session)</li>
              <li>Many parallel requests (streams)</li>
              <li>Header compression</li>
              <li>Stream prioritization</li>
              <li>Server push</li>
            </ul> 

            <aside class="notes">
              qu'est-ce que ça veut dire du coup ?
              une requête n'est pas obligé d'attendre une réponse pour se lancer 
              le serveur (donc l'application) peut décider quelles resources sont prioritaires et les prioriser dans le flux
              le serveur peut envoyer des resources qui n'ont pas encore été requêtées (avec un mécanisme d'annulation possible si le navigateur l'a dans le cache
            </aside>

          </section>

          <section>
            <h2>remove CSS and JS concatenation</h2>

            <ul>
              <li>to help code start earlier</li>
              <li>to maximize resource caching between pages</li>
            </ul>
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

          <section>
            <h2>remove sharding</h2>

            <ul>
              <li>prevent many DNS resolutions</li>
              <li>prevent slow start of new connetions</li>
            </ul>
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

          <section>
            <h2>Nouvelles fonctionnalités</h2>

            <ul>
              <li>Use server hints to help browser load faster vip resources</li>
              <li>Server push is powerful when resources are not already in browser cache</li>
              <li>SDCH</li>
            </ul>
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

         </section>

        </section>

        <section>
          <section>
            <h2>Budget webperf</h2>

            <ul>
              <li>Service workers</li>
              <li>Timeout sync scripts</li>
            </ul>
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

         </section>

        </section>

        <section>

          <section>
            <h1>Et les images</h1>
            <img src="assets/repartition poids des pages.png">
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

          <section>
          <h2>Nouveaux formats</h2>
          <h3>JPG 2000, JPG-XR, WebP
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

          <section>
            Ancien formats
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

          <section>
            JPG
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

          <section>
            GIF
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

          <section>
            Compressive images
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

          <section>
            Hero image
            This is the case why I can’t wait for HTTP/2 + progressive JPEG mashup!

            An HTTP/2 server can send the first few KB of the hero JPEG first (which would serve as a low-resolution placeholder), then send all the styles, scripts, etc. and resume sending the rest of the hero image last.

            This way you’d avoid the blank space without noticeably slowing anything else.
 
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>    

        </section>

        <section>

          <section>
            Nouvelles métriques
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

        </section>

        <section>

          <section>
          Conclusion
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

          <section>
          ce qui est toujours d'actualité
          compression des pages : gzip, images
          cache (expires, etags si bien configuré)
          CDN 
          CSS on top / deferJS
 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

           <section>
          chargement progressif, asynchrone avec le moins de requetes DNS possible et avec un budget webperf

 
            <aside class="notes">
              Rapidement, c'est quoi la webperf ?<br>
              Moi j'ai une définition simple
            </aside>

          </section>

        </section>

			</div>

			<div class="icon-bar" style="width:100%">
					<a class="image" href="http://www.fasterize.com" style="font-size:28px; font-family: AvenirNext-Medium,Arial,sans-serif; color: #FFF;"><img src="assets/fasterize_logo_mini_blanc.svg" class="plain"/><span class="logo_title">fasterize</span></a>
          <div align="right" style="float:right">
					<a class="image" href="https://twitter.com/stefounet"><span>twitter</span></a>|
          <a class="image" href="mailto:info@fasterize.com"><span>email</span></a>|
          <a class="image" href="http://blog.fasterize.com/"><span>blog</span></a>
        </div>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
